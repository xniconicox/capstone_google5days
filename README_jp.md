
# 🛰️ 衛星データメタデータ検索エージェント

*Natural-language Satellite Metadata Search Agent (MVP)*

## 📌 概要

衛星データを探す際、従来は以下のような複雑な手作業が必要でした：

* カタログ画面での地名入力・座標指定
* 期間の設定、雲量フィルタの調整
* 衛星ミッション（Sentinel / Landsat など）の選択
* STAC クエリ構造の理解

本プロジェクトでは、これらの複雑な操作をすべて隠蔽し、
**自然言語で要望を伝えるだけで衛星データを自動検索・推薦してくれるエージェント**
を構築します。

---

## 🎯 目的

* **自然言語 → 構造化検索クエリ**（期間 / AOI / 衛星ミッション / 雲量）
* **STAC API への自動クエリ生成**
* **シーンの抽出・整形・要約**
* **もっとも条件に合う候補の推薦**
* （オプション）**検索条件を記憶し、後続クエリに活用**

従来の衛星データ検索の「専門知識・操作負荷」を極限まで下げることを目指します。

---

## 🏗️ 全体アーキテクチャ

```
User (自然言語)
        ↓
 LLM Agent (ADK)
        ↓
 ┌───────────────────────┐
 │ 1. resolve_aoi          │  → 地名/地域 → bbox
 │ 2. find_satellite_scenes│  → 検索条件に基づき STAC API へアクセス
 └───────────────────────┘
        ↓
 Agent → 結果を整形・要約・表形式化
        ↓
    Final Answer
```

* **ADK を用いた単一エージェント構成**
* **MCP に準拠したタスク指向のツール設計**
* **自然言語 → JSON パラメータ変換 → ツール呼び出しのループ**

---

## 🧰 使用技術

* **Google ADK (Agent Development Kit)**
  エージェント構築・ツール呼び出し・セッション管理
* **STAC API**
  （Element84 Earth Search / Microsoft Planetary Computer）
* Python, httpx / pystac-client
* pandas による表形式整形

---

## ✨ 特徴

### ✔ 自然言語で検索条件を指定

例：「2023年夏頃の北海道東側で雲量10%未満の Sentinel-2 を見せて」

### ✔ 自動で以下を判定

* 時期（例：「夏頃」→ 6–8 月）
* 観測地域（地名 → 座標/BBOX）
* 衛星ミッション（例：「光学系」→ Sentinel-2 など）
* 雲量の閾値

### ✔ 結果は表形式 & 要約付きで返却

| id | datetime | cloud% | preview |
| -- | -------- | ------ | ------- |

### ✔ 検索条件を記憶（オプション）

「前回と同じ場所で冬のデータも」などに対応。

---

## 🧪 MVP の範囲

本エージェントは **最小実用製品（MVP）** として以下を対象とします。

* 対応衛星：**Sentinel-2**（L2A）
* 地名 → bbox: 代表的な地域のみ対応
* 分析機能なし（メタデータ検索のみ）
* 1クエリ1回答の簡易対話

---

## 📅 開発スケジュール（達成済み）

### **Day 1：STAC 接続**

* ハードコード検索成功
* メタデータ抽出（id / datetime / cloud / preview）

### **Day 2：ツール化（MCP 準拠）**

* resolve_aoi
* find_satellite_scenes
* ADK でツール公開

### **Day 3：エージェント構築**

* 自然言語 → JSON パラメータ抽出プロンプト設計
* End-to-End 動作（notebook デモ）

---

## 🆚 既存研究との差別化（Value / Novelty）

既存の STAC 検索ツール（Semantic STAC Search, GeoAgents など）は
**研究プロトタイプが中心**で、以下の課題があります：

| 項目         | 既存   | 本プロジェクト      |
| ---------- | ---- | ------------ |
| 日本語対応      | ×    | ◎            |
| エージェント構造   | 弱い   | ADK/MCP 準拠   |
| デプロイ性      | 対象外  | CI/CD,運用まで想定 |
| 拡張性        | 固定的  | ツール分割で自由度高い  |
| メモリ        | ほぼなし | セッション統合      |
| 分析エージェント連携 | 想定外  | 今後連携前提       |

特に次の点が価値の核心です：

### ⭐ 実運用に耐えるアーキテクチャ（白書準拠）

* MCP に合わせたツール定義
* セッション・メモリ・トレーシング
* 評価/テスト設計
* デプロイメント戦略（Canary, CI/CD）

→ **既存ツールは研究デモで、本プロジェクトは“製品としてのAI検索エージェント”の構造を持つ。**

---

## 🚀 今後の拡張（Strong Roadmap）

### 1. **複数ミッション対応**

* Landsat-8/9
* Sentinel-1（SAR）
* ALOS/JAXA 系

### 2. **可視化 / 地図 UI**

* プレビュー画像
* 地図上に検索結果をプロット

### 3. **画像処理エージェントとの連携**

* NDVI 計算
* クラウドマスク
* チップ抽出
* 時系列変化検出

→ **検索エージェント → 前処理エージェント → 解析エージェント**
というマルチエージェント構成へ自然に発展。

### 4. **時系列モニタリング**

* 「毎週この場所の雲量10%以下のシーンを自動通知」

### 5. **RAG + 衛星データ知識ベース**

* 各衛星の特性から「どのセンサーが最適か」を自動判断

---

## ⚠️ 制約・リスク（Transparent）

* 地名の曖昧性（例：「北海道東側」）
  → 必要に応じてフォローアップ質問
* STAC の cloud_cover の精度限界
* 大規模検索はレートリミット・レスポンス遅延
* LLM による API 仕様ハルシネーションリスク

ただしこれらはすべて MVP では「割り切り」前提。
将来的にはバリデーションや UI 提示で改善可能。

---

## 📚 参考資料

* STAC Spec
* Element84 Earth Search
* Microsoft Planetary Computer
* Google ADK / MCP Whitepapers
* Development Seed STAC Semantic Search
* GeoAgents (OpenGeoAI)

---

## 📄 ライセンス

MIT

---

## 🤝 貢献

Issue / PR 歓迎

